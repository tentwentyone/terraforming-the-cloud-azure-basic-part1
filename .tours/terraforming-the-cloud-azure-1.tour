{
  "$schema": "https://aka.ms/codetour-schema",
  "title": "terraforming-the-cloud-azure-1",
  "steps": [
    {
      "file": "README.md",
      "description": "Bem-vindo ao workshop!\n\nAqui tens um breve resumo dos conteÃºdos abordados neste mÃ³dulo.\n\nAproveita para dar uma vista de olhos nos tÃ³picos e verificar se tens todos os requisitos para prosseguir com o workshop.",
      "line": 1
    },
    {
      "file": "README.md",
      "description": "Certifica-te que estÃ¡s no teu terminal fazendo o comando:\n- **ctrl+Ã§**\n\nAlternativamente, no canto superior esquerdo, podes tambÃ©m clicar em:\n\n- **View** e depois selecionar **Terminal**",
      "line": 5
    },
    {
      "file": "README.md",
      "description": "No terminal faz login em Azure utilizando o comando:\n>> az login --use-device-code --tenant nosportugal.onmicrosoft.com",
      "line": 11
    },
    {
      "file": "README.md",
      "description": "Para definir a subscriÃ§Ã£o:\n\n- Seleciona-a de entre as opÃ§Ãµes disponÃ­veis no teu terminal recorrendo ao NÂº da mesma.\n\nAlternativamente executa o comando:\n\n>> az account set --subscription tto-terraform-workshops-np\n\nSe quiseres ver todas as tuas subscriÃ§Ãµes utiliza:\n\n>> az account list --output table",
      "line": 13,
      "selection": {
        "start": {
          "line": 3,
          "character": 35
        },
        "end": {
          "line": 3,
          "character": 51
        }
      }
    },
    {
      "file": "README.md",
      "description": "Certifica-te que estÃ¡s na subscriÃ§Ã£o correcta utilizando o comando:\n\n>> az account show",
      "line": 12
    },
    {
      "file": "scripts/get-azure-credentials.sh",
      "description": "Executa o seguinte script com o comando:\n\n>> source ./scripts/get-azure-credentials.sh",
      "line": 1
    },
    {
      "file": "main.tf",
      "description": "1. **O primeiro contacto**\n\nNesta secÃ§Ã£o iremos executar os 4 principais comandos de terraform: init, plan, apply e destroy.\n\n**[terraform init](https://developer.hashicorp.com/terraform/cli/commands/init)**\n- O comando terraform init Ã© utilizado para inicializar uma diretoria que contÃ©m ficheiros de configuraÃ§Ã£o de Terraform. Este Ã© o primeiro comando que deve ser executado apÃ³s escrever uma nova configuraÃ§Ã£o de Terraform ou clonar uma existente. Ã‰ seguro executar este comando vÃ¡rias vezes.",
      "line": 1,
      "selection": {
        "start": {
          "line": 18,
          "character": 3
        },
        "end": {
          "line": 18,
          "character": 18
        }
      }
    },
    {
      "file": "main.tf",
      "description": "Para comeÃ§ar executa o comando:\n\n>> terraform init",
      "line": 2,
      "selection": {
        "start": {
          "line": 1,
          "character": 1
        },
        "end": {
          "line": 3,
          "character": 21
        }
      }
    },
    {
      "file": "main.tf",
      "description": "**[terraform plan](https://developer.hashicorp.com/terraform/cli/commands/plan)**\n\nO comando terraform plan cria um plano de execuÃ§Ã£o, permitindo visualizar antecipadamente as alteraÃ§Ãµes que o Terraform pretende fazer Ã  infraestrutura. Por predefiniÃ§Ã£o, quando o Terraform cria um plan:\n\n- LÃª o estado atual de quaisquer objetos remotos existentes para garantir que o estado do Terraform estÃ¡ atualizado.\n- Compara a configuraÃ§Ã£o atual com o estado anterior e regista quaisquer diferenÃ§as.\n- PropÃµe um conjunto de aÃ§Ãµes que, se aplicadas, farÃ£o com que os objetos remotos correspondam Ã  configuraÃ§Ã£o.",
      "line": 1
    },
    {
      "file": "main.tf",
      "description": "Para veres as alteraÃ§Ãµes a serem feitas Ã  tua infraestrutura executa o comando:\n\n>> terraform plan",
      "line": 3
    },
    {
      "file": "main.tf",
      "description": "**[terraform apply](https://developer.hashicorp.com/terraform/cli/commands/apply)**\n\n- O comando terraform apply executa as aÃ§Ãµes propostas num plan de Terraform.",
      "line": 2
    },
    {
      "file": "main.tf",
      "description": "Para aplicares as alteraÃ§Ãµes executa o comando:\n\n>> terraform apply\n\nâ—NÃ£o te esqueÃ§as de escrever **yes** para confirmar o apply.\n\nâ³ Tempo do apply - 1 min.",
      "line": 4
    },
    {
      "file": "main.tf",
      "description": "Para verificares que os recursos remotos foram criados executa o comando:\n\n>> az group show --name=$(terraform output -raw my_identifier)-rg --output table\n\nExamina todos os resource groups criados com o comando:\n\n>> az group list --output table",
      "line": 5,
      "selection": {
        "start": {
          "line": 3,
          "character": 5
        },
        "end": {
          "line": 3,
          "character": 82
        }
      }
    },
    {
      "file": "main.tf",
      "description": "**[terraform destroy](https://developer.hashicorp.com/terraform/cli/commands/destroy)**\n\n- O comando terraform destroy Ã© uma forma prÃ¡tica de destruir todos os objetos geridos por uma determinada configuraÃ§Ã£o de Terraform.\n\nEmbora normalmente nÃ£o se queira destruir objetos num ambiente de produÃ§Ã£o, o Terraform Ã©, por vezes, utilizado para gerir infraestrutura efÃ©mera para fins de desenvolvimento. Nesse caso, podemos utilizar o terraform destroy para apagar todos estes recursos.",
      "line": 3
    },
    {
      "file": "main.tf",
      "description": "Vamos destruir os recursos, para tal executa o comando:\n\n>> terraform destroy\n\nâ³ Tempo do destroy - 1 min.",
      "line": 7
    },
    {
      "file": "main.tf",
      "description": "Confirma a destruiÃ§Ã£o dos recursos:\n\n>> az group list --output table | grep '$(terraform output -raw my_identifier)-rg'\n\nNÃ£o deverÃ¡ apresentar resultados porque estes recursos foram destruÃ­dos.",
      "line": 8,
      "selection": {
        "start": {
          "line": 6,
          "character": 37
        },
        "end": {
          "line": 6,
          "character": 53
        }
      }
    },
    {
      "file": "main.tf",
      "selection": {
        "start": {
          "line": 72,
          "character": 1
        },
        "end": {
          "line": 125,
          "character": 4
        }
      },
      "description": "2. Lidar com as alteraÃ§Ãµes\n\nNesta secÃ§Ã£o iremos demonstrar a utilizaÃ§Ã£o de terraform perante vÃ¡rios tipos de alteraÃ§Ãµes.\n\nDescomenta o bloco referente ao **Exercicio 2.**\n\nSeleciona o bloco referente ao **ExercÃ­cio 2** e prime:\n\n- Windows: **ctrl+k+u**\n- Mac: **cmd+k+u**.\n\nâ—Certifica-te que o ficheiro estÃ¡ guardado com o comando:\n\n- Windows: **ctrl+s**.\n- Mac: **cmd+s**."
    },
    {
      "file": "main.tf",
      "description": "Executa o plan:\n\n>> terraform plan\n\nâš ï¸ Repara que os recursos criados no **ExercÃ­cio 1** vÃ£o ser recriados. Isto acontece porque apesar de terem sido destruÃ­dos na atividade anterior continuam declarados no cÃ³digo.",
      "line": 60
    },
    {
      "file": "main.tf",
      "description": "Executa o apply:\n\n>> terraform apply\n\nâ—NÃ£o te esqueÃ§as de escrever yes para confirmar o apply.\n\nâŒ›Tempo do apply 2:00 min.",
      "line": 62
    },
    {
      "file": "main.tf",
      "description": "Verifica que a tua virtual machine foi criada!\n\n>> az vm show -g=$(terraform output -raw my_identifier)-rg -n=$(terraform output -raw my_identifier)-vm -d --output table\n\nSe quiseres ver todas as virtual machines criadas executa o comando:\n\n>> az vm list --output table",
      "line": 63
    },
    {
      "file": "main.tf",
      "selection": {
        "start": {
          "line": 94,
          "character": 1
        },
        "end": {
          "line": 97,
          "character": 8
        }
      },
      "description": "Localiza o recurso **azurerm_virtual_machine.default** e descomenta o campo **tags**\n\nSeleciona o conteÃºdo e prime:\n\n- Windows: **ctrl+k+u**\n- Mac: **cmd+k+u**.\n\nâ—Certifica-te que o ficheiro estÃ¡ guardado com o comando:\n\n- Windows: **ctrl+s**.\n- Mac: **cmd+s**."
    },
    {
      "file": "main.tf",
      "description": "Executa o plan:\n\n>> terraform plan\n\nExecuta o apply:\n\n>> terraform apply\n\nâŒ›Tempo do apply 30 sec.",
      "line": 81
    },
    {
      "file": "main.tf",
      "description": "Podes ver a tag que adicionaste Ã  tua Virtual Machine com o comando:\n\n>> az vm show --name $(terraform output -raw my_identifier)-vm --resource-group $(terraform output -raw my_identifier)-rg --query \"tags\"",
      "line": 83
    },
    {
      "file": "main.tf",
      "selection": {
        "start": {
          "line": 73,
          "character": 1
        },
        "end": {
          "line": 73,
          "character": 65
        }
      },
      "description": "2.2 **Introduzindo alteraÃ§Ãµes disruptivas**\n\nLocaliza o recurso **azurerm_virtual_machine.default** e altera o campo *name* para o seguinte:\n\n- **\"${random_pet.this.id}-vm-new\"**\n\nâ—Certifica-te que o ficheiro estÃ¡ guardado com o comando:\n\n- Windows: **ctrl+s**.\n- Mac: **cmd+s**."
    },
    {
      "file": "main.tf",
      "description": "- Executa o **terraform plan** e verifica que o Terraform irÃ¡ efectuar um *replacement* - Ã© uma alteraÃ§Ã£o disruptiva.\n\n>> terraform plan\n\nExecuta o apply:\n\n>> terraform apply\n\nâŒ›Tempo do apply 2 min.\n",
      "line": 66
    },
    {
      "file": "main.tf",
      "description": "Verifica que a nova virtual machine foi criada!\n\n>> az vm show -g=$(terraform output -raw my_identifier)-rg -n=$(terraform output -raw my_identifier)-vm-new -d --output table\n\nPara veres todas as Virtual Machines executa o comando:\n\n>> az vm list --output table",
      "line": 55
    },
    {
      "file": "terraform.tfvars",
      "selection": {
        "start": {
          "line": 6,
          "character": 1
        },
        "end": {
          "line": 6,
          "character": 24
        }
      },
      "description": "2.3 **Introduzindo alteraÃ§Ãµes dependentes**\n\n- Altera o valor da variavel prefix de **az** para **new**\n\nâ—Certifica-te que as tuas alteraÃ§Ãµes estÃ£o guardadas com o comando:\n\n- Windows: **ctrl+s**.\n- Mac: **cmd+s**."
    },
    {
      "file": "terraform.tfvars",
      "description": "Executa o plan e verifica que todo o grafo de dependÃªncias Ã© afetado:\n\n>> terraform plan\n\nExecuta o apply\n\n>> terraform apply\n\nâŒ›Tempo do apply 4:00 min.\n\n*Notem que apenas alterÃ¡mos uma mera variÃ¡vel...*",
      "line": 4
    },
    {
      "file": "import-exercise.tf",
      "description": "3. **[Terraform Import](https://developer.hashicorp.com/terraform/tutorials/state/state-import) & Move**\n\nTerraform Import possibilita colocar infraestrutura jÃ¡ existente sob a tua gestÃ£o. Ao importar recursos para o terraform, podes gerir a tua infraestrutura de maneira coerente e consistente utilizando um fluxo de trabalho comum.\n\nEsta Ã© uma boa maneira de se fazer uma transiÃ§Ã£o gradual da infraestrutura para o terraform, ou de garantir que no futuro podemos utilizar o terraform, mesmo que actualmente ele nÃ£o tenha todas as capacidades que desejarÃ­amos.",
      "line": 1
    },
    {
      "file": "import-exercise.tf",
      "description": "Assegura-te que nÃ£o existem alteraÃ§Ãµes pendententes:\n\n>> terraform plan\n\nSe o plan apresentar mudanÃ§as, faÃ§am o apply com o comando:\n\n>> terraform apply",
      "line": 2
    },
    {
      "file": "import-exercise.tf",
      "description": "3.1 **Criar um recurso (azurerm_virtual_network) usando os comandos azure**\n\nNesta parte vamos criar recursos recorrendo a uma ferramenta externa ao terraform por forma a criar um use-case de recursos que existem fora do state do terraform.\n\nO objetivo Ã© simular recursos que jÃ¡ existiam para que os possamos terraformar.\n\nCria uma Virtual Network com o comando:\n\n>> az network vnet create --name=$(terraform output -raw my_identifier)-import-vnet --subscription=\"$(terraform output -raw subscription_name)\" --resource-group=$(terraform output -raw my_identifier)-rg\n\nâŒ›Tempo para a criaÃ§Ã£o do recurso 30 segundos.\n\nPara verificar se a virtual network foi criada:\n\n>> az network vnet show --name=$(terraform output -raw my_identifier)-import-vnet --subscription=\"$(terraform output -raw subscription_name)\" --resource-group=$(terraform output -raw my_identifier)-rg --output table\n\nPara verificar todas as virtual networks existentes:\n\n>> az network vnet list --output table",
      "line": 4
    },
    {
      "file": "import-exercise.tf",
      "description": "3.2 **Importar recursos existentes**\n\nNesta parte vamos criar o bloco de import para fazer a importaÃ§Ã£o do recurso criado anteriormente.\n\nO processo de importaÃ§Ã£o de recursos consiste em duas partes:\n\n- ObtenÃ§Ã£o da informaÃ§Ã£o do recurso na cloud.\n- CriaÃ§Ã£o de um bloco import que irÃ¡ indicar ao terraform que o recurso jÃ¡ existe e que o mesmo deve ser gerido pelo terraform.",
      "line": 8
    },
    {
      "file": "import-exercise.tf",
      "description": "O primeiro passo da importaÃ§Ã£o de recursos Ã© declarar a importaÃ§Ã£o dos mesmos.\n\nPara isto, temos que definir o bloco import, que necessita de dois argumentos:\n\n- id: o id do recurso a importar do lado de Azure\n- to: o identificador terraform do recurso a importar",
      "line": 14
    },
    {
      "file": "import-exercise.tf",
      "selection": {
        "start": {
          "line": 21,
          "character": 1
        },
        "end": {
          "line": 39,
          "character": 1
        }
      },
      "description": "Para o exercicio que segue, descomenta o conteÃºdo no ficheiro **import-exercise.tf**\n\nUtiliza o comando:\n\n- Windows: **ctrl+k+u**\n- Mac: **cmd+k+u**.\n\nâ—Verifica se as tuas alteraÃ§Ãµes estÃ£o guardadas com o comando:\n\n- Windows: **ctrl+s**.\n- Mac: **cmd+s**.\n"
    },
    {
      "file": "import-exercise.tf",
      "description": "O que estamos a fazer Ã© a definir um **bloco de import** em que especificamos o recurso a importar e o seu destino.\n\nTemos no entanto de definir o destino do mesmo para que possamos alojar o recurso e passar a geri-lo por terraform, Ã© essa a razÃ£o pela qual definimos um **bloco de resource** no import-exercise.tf.\n\n",
      "line": 10
    },
    {
      "file": "import-exercise.tf",
      "description": "Executa o plan:\n\n>> terraform plan\n\nO resultado do plan deverÃ¡ de apresentar:\n\n```Plan: 1 to import, 0 to add, 0 to change, 0 to destroy.```\n\nExecuta o apply:\n\n>> terraform apply\n\nâŒ›Tempo do apply - 10 segundos.",
      "line": 11
    },
    {
      "file": "import-exercise.tf",
      "description": "Executa o plan:\n\n>> terraform plan\n\nSe o terraform indicar que nÃ£o tem alteraÃ§Ãµes Ã  infraestrutura, confirma-se que os recursos foram importados com sucesso.",
      "line": 13
    },
    {
      "file": "move-exercise.tf",
      "description": "3.3 **Move**\n\nO [move](https://developer.hashicorp.com/terraform/cli/state/move) Ã© usado em casos onde Ã© importante preservar o objeto existente na infraestrutura, reorganizando a nossa configuraÃ§Ã£o de Terraform, renomeando recursos, entre outros casos mais complexos como movendo recursos entre mÃ³dulos.\n\nVamos agora supÃ´r que queremos mudar o nome dum recurso em terraform. Se formos mudar o nome do recurso, o terraform irÃ¡ considerar que estamos a destruir o recurso anterior e a querer criar um novo com as mesmas especificaÃ§Ãµes.\n\nPara evitar esse comportamento, uma vez que nÃ£o queremos destruir o recurso, vamos usar o move.",
      "line": 1
    },
    {
      "file": "move-exercise.tf",
      "selection": {
        "start": {
          "line": 19,
          "character": 1
        },
        "end": {
          "line": 23,
          "character": 4
        }
      },
      "description": "No ficheiro **move-exercise.tf** descomenta o **resource** do **random.pet** **( Exercicio 3.3.1)**\nSeleciona o conteÃºdo e utiliza o comando:\n\n- Windows: **ctrl+k+u**\n- Mac: **cmd+k+u**.\n\nExecuta o plan:\n\n>> terraform plan\n\nExecuta o apply:\n\n>> terraform apply\n\nâŒ›Tempo do apply - 20 segundos."
    },
    {
      "file": "move-exercise.tf",
      "selection": {
        "start": {
          "line": 19,
          "character": 1
        },
        "end": {
          "line": 19,
          "character": 35
        }
      },
      "description": "Agora, vamos mudar o nome do recurso **resource \"random_pet\" \"new_id\"**.\n\nAltera o nome para:\n\n- **resource \"random_pet\" \"moved\"**."
    },
    {
      "file": "move-exercise.tf",
      "description": "Como podem ver, ao alterar o nome do recurso o terraform pretende destruir o recurso anterior e criar um novo.\n\nâš ï¸ **NÃƒO DESTRUIR OS RECURSOS / NÃƒO FAZER APPLY DOS RECURSOS**",
      "line": 7
    },
    {
      "file": "move-exercise.tf",
      "selection": {
        "start": {
          "line": 27,
          "character": 1
        },
        "end": {
          "line": 30,
          "character": 4
        }
      },
      "description": "Para alterar o nome do recurso sem que o mesmo seja destruÃ­do, descomentamos o **bloco moved** **(Exercicio 3.3.2)**.\n\nIsto farÃ¡ com que o nome do recurso seja alterado, evitando que este seja destruÃ­do e recriado.\n\nUtiliza o comando:\n\n- Windows: **ctrl+k+u**\n- Mac: **cmd+k+u**.\n"
    },
    {
      "file": "move-exercise.tf",
      "description": "Executa o plan:\n\n>> terraform plan\n\nO resultado deverÃ¡ ser algo como:\n\n```random_pet.new_id has moved to random_pet.moved```",
      "line": 9
    },
    {
      "file": "move-exercise.tf",
      "description": "Executa o apply:\n\n>> terraform apply\n\nâŒ›Tempo do apply - 20 segundos.\n\nDesta forma, conseguimos manter o mesmo objeto e mudar o seu nome, sem ter de o destruir!",
      "line": 11
    },
    {
      "file": "last-exercise.tf",
      "description": "4. **ExercÃ­cio**\n\nNeste exercicio o objectivo Ã© aplicar alguns dos conhecimentos adquiridos nesta sessÃ£o sem que exista uma soluÃ§Ã£o pronta para descomentarem ğŸ˜‰.\n\nğŸ‘‰ Criar uma User-Assigned Managed Identity com os seguintes requisitos:\n- name deverÃ¡ ser prefixada com valor definido no recurso random_pet.this.id para evitar colisÃµes de nomes\n\nğŸ‘‰ Criar uma Azure Virtual Machine com os seguintes requisitos:\n- Nome da mÃ¡quina deverÃ¡ ser: ${random_pet.this.id}-vm-final\n- Tipo de mÃ¡quina: Standard_B1ls\n- Zona: westeurope\n- DeverÃ¡ conter uma tag.\n- A rede (subnetwork) onde a VM vai correr fica ao vosso critÃ©rio: podem criar uma nova, ou podem usar as jÃ¡ existentes.\n- A mÃ¡quina deverÃ¡ correr com a azurerm_user_assigned_identity previamente criada.\n\nğŸ‘‰ Devem fazer o exercicio no ficheiro last-exercise.tf.",
      "line": 1
    },
    {
      "file": "last-exercise.tf",
      "description": "AjudasğŸ˜µ\nğŸ’¡ Usem a pesquisa no terraform registry / azure para saberem mais informaÃ§Ã£o acerca dos recursos que estÃ£o a usar:\n\n- [azurerm_user_assigned_identity](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/user_assigned_identity)\n- [azurerm_virtual_machine](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/linux_virtual_machine)\n- [azurerm_network_interface](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/network_interface)\n- [azurerm_subnet](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/subnet)\n\nğŸ’¡ Uma subnet jÃ¡ existente poderÃ¡ ser **azurerm_subnet.default.id.**",
      "line": 2
    },
    {
      "file": "main.tf",
      "description": "5. **Wrap-up & Destroy**\n\nDestruir os conteÃºdos!\n\n>> terraform destroy\n\nğŸ”šğŸ ChegÃ¡mos ao fim ğŸğŸ”š",
      "line": 113
    }
  ],
  "ref": "main"
}